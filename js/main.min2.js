/*!
 *
 *  Web Starter Kit
 *  Copyright 2014 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
!function(e){"use strict";for(var r=document.querySelectorAll("a.scroll"),t=r.length,n=/firefox|trident/i.test(navigator.userAgent)?document.documentElement:document.body,i=function(e,r,t,n){return(e/=n/2)<1?t/2*e*e*e+r:t/2*((e-=2)*e*e+2)+r};t--;)r.item(t).addEventListener("click",function(e){var r,t=n.scrollTop,o=document.getElementById(/[^#]+$/.exec(this.href)[0]).getBoundingClientRect().top,a=n.scrollHeight-window.innerHeight,l=a>t+o?o:a-t,d=900,s=function(e){r=r||e;var o=e-r,a=i(o,t,l,d);n.scrollTop=a,d>o&&requestAnimationFrame(s)};requestAnimationFrame(s),e.preventDefault()});var o=Matter.Engine,a=Matter.World,l=Matter.Bodies,d=Matter.Body,s=Matter.Composite,c=(Matter.Composites,Matter.Common),g=(Matter.Constraint,Matter.Events);Matter.Bounds,Matter.Vector,Matter.MouseConstraint,Matter.Mouse,Matter.Query;if(window.MatterTools){MatterTools.Gui,MatterTools.Inspector}var w,f={},h=[],y=(-1!==window.location.hash.indexOf("-inspect"),/(ipad|iphone|ipod|android)/gi.test(navigator.userAgent));f.init=function(){var e=document.getElementById("cells"),r={positionIterations:6,velocityIterations:4,enableSleeping:!1};w=o.create(e,r),o.run(w),f.cells()},window.addEventListener?window.addEventListener("load",f.init):window.attachEvent&&window.attachEvent("load",f.init),f.cells=function(){var e=w.world;f.reset(),w.world.gravity.y=0,w.world.gravity.x=0;var r=w.render.options;r.wireframes=!1,r.width=2*window.innerWidth,r.height=2*window.innerHeight,r.showAngleIndicator=!1,r.background="rgba(255,255,255,0)",w.render.canvas.width=2*window.innerWidth,w.render.canvas.height=2*window.innerHeight,w.world.bounds.max.x=window.innerWidth,w.world.bounds.max.y=window.innerHeight,w.render.context.scale(2,2);a.add(e,[l.rectangle(0,0,10,2*window.innerHeight,{isStatic:!0,render:{fillStyle:"rgba(255,255,255,0)",strokeStyle:"rgba(255,255,255,0)"}}),l.rectangle(window.innerWidth,0,10,2*window.innerHeight,{isStatic:!0,render:{fillStyle:"rgba(255,255,255,0)",strokeStyle:"rgba(255,255,255,0)"}}),l.rectangle(0,0,2*window.innerWidth,10,{isStatic:!0,render:{fillStyle:"rgba(255,255,255,0)",strokeStyle:"rgba(255,255,255,0)"}}),l.rectangle(0,window.innerHeight,2*window.innerWidth-10,10,{isStatic:!0,render:{fillStyle:"rgba(255,255,255,0)",strokeStyle:"rgba(255,255,255,0)"}})]);var t=0,n=0;n=Math.floor(window.innerWidth/40);var i=function(e,r,t){var n=c.random(10,50)/100;n=n.toFixed(2);var i=s.create({label:"Cell"}),o=l.circle(e,r,t,{label:"Membrane",friction:1e-5,restitution:1e-4,density:.1,render:{fillStyle:"rgba(102,53,151,0)",fillStyleTo:"rgba(102,53,151,0)",strokeStyle:"rgba(102,53,151,0)",strokeStyleTo:"rgba(102,53,151,"+n+")",lineWidth:2}}),a=l.circle(e,r,t/5,{label:"Nucleus",friction:0,restitution:0,density:.1,render:{fillStyle:"rgba(102,53,151,0)",fillStyleTo:"rgba(102,53,151,"+n+")",strokeStyle:"rgba(102,53,151,0)",lineWidth:0}});return s.addBody(i,o),s.addBody(i,a),a.slop=0,a.friction=0,a.density=0,a.inertia=0,c.random(1,600)>560&&(i.cancer=!0),i.bodies[0].parentId=i.id,i};h.push(g.on(w,"collisionStart",function(e){for(var r=e.pairs,t=s.allComposites(w.world),n=0;n<t.length;n++){var i=t[n],o=i.bodies[0];o.id==r[0].bodyA.id&&c.random(0,10)>9&&(i.cancer=!0)}})),h.push(g.on(w,"beforeUpdate",function(r){var l=r.source;if(r.timestamp%10<20&&(o(l),++t<n)){var d=c.random(50,window.innerWidth-50),s=c.random(50,window.innerHeight-50),g=c.random(3,30);a.add(e,i(d,s,g))}}));var o=function(e){for(var r=s.allComposites(e.world),t=0;t<r.length;t++){var n,i=r[t],o=i.bodies[1],a=i.bodies[0];i.cancer?(o.render.fillStyle=y(o.render.fillStyle,"rgba(255,0,0,0.5)"),a.render.fillStyle=y(a.render.fillStyle,"rgba(255,0,0,0)"),a.render.strokeStyle=y(a.render.strokeStyle,"rgba(255,0,0,0.5)")):(o.render.fillStyle=y(o.render.fillStyle,o.render.fillStyleTo),a.render.fillStyle=y(a.render.fillStyle,a.render.fillStyleTo),a.render.strokeStyle=y(a.render.strokeStyle,a.render.strokeStyleTo)),o.position.x=a.position.x,o.position.y=a.position.y,n=i.cancer?.01*i.bodies[1].mass:.001*i.bodies[1].mass,d.applyForce(i.bodies[0],{x:0,y:0},{x:(n+c.random(-1,1)*n)*c.choose([1,-1]),y:(n+c.random(-1,1)*n)*c.choose([1,-1])})}},y=function(e,r){var t={},n={};return t.r=parseInt(e.split(",")[0].split("(")[1]),t.g=parseInt(e.split(",")[1]),t.b=parseInt(e.split(",")[2]),t.a=parseFloat(e.split(",")[3]),n.r=parseInt(r.split(",")[0].split("(")[1]),n.g=parseInt(r.split(",")[1]),n.b=parseInt(r.split(",")[2]),n.a=parseFloat(r.split(",")[3]),t.r!=n.r&&(t.r=t.r<n.r?t.r+=10:t.r-=10),t.g!=n.g&&(t.g=t.g<n.g?t.g+=10:t.g-=10),t.b!=n.b&&(t.b=t.b<n.b?t.b+=10:t.b-=10),t.a!=n.a&&(t.a=t.a<n.a?t.a+=.001:t.a-=.001),e="rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}},f.reset=function(){var e=w.world;a.clear(e),o.clear(w);var r=w.render.controller;r.clear&&r.clear(w.render);for(var t=0;t<h.length;t++)g.off(w,h[t]);if(e.events)for(t=0;t<h.length;t++)g.off(e,h[t]);h=[],c._nextId=0,c._seed=0,w.enableSleeping=!1,w.world.gravity.y=1,w.world.gravity.x=0,w.timing.timeScale=1;var n=w.render.options;n.wireframes=!0,n.hasBounds=!1,n.showDebug=!1,n.showBroadphase=!1,n.showBounds=!1,n.showVelocity=!1,n.showCollisions=!1,n.showAxes=!1,n.showPositions=!1,n.showAngleIndicator=!0,n.showIds=!1,n.showShadows=!1,n.background="#fff",y&&(n.showDebug=!0)}}(jQuery);